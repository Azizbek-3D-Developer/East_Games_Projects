{% extends "Dashboard/dashboard.html" %}

{% block title %}Document Details{% endblock %}

{% block secondary_stylesheets %}
  <link rel="stylesheet" href="{{ url_for('static', path='styles/Dashboard/Documents/documents-details-styles.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='styles/Dashboard/Documents/documents-details-mobile-styles.css') }}" />
{% endblock %}

{% block data_container %}
<div class="document-details-container">
  <h1>Document Details</h1>

  <section class="document-info">
    <h2>{{ document.display_name or document.filename }}</h2>
    <p><strong>Uploaded at:</strong> {{ document.uploaded_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
    <div class="a_a-doc-content">
      <p>{{ document.filecontent }}</p>
    </div>
    <div class="a_a-huffman-button-section">
      <a href="/dashboard/documents/{{ document.id }}/huffman" class="a_a-card-btn">View Huffman Encoding</a>
    </div>
  </section>

  <section class="collapsible-section">
    <button class="collapsible-toggle">Collections ▾</button>
    <div class="collapsible-content">
      <h3 class="a_a-collections-documents-title">Document belongs to these Collections</h3>
      {% if collections %}
        <div class="a_a-documents-list">
          {% for col_item in collections %}
            <div class="a_a-document-card">
              <p class="a_a-document-name"><strong>Name:</strong> {{ col_item.name }}</p>
              <p class="a_a-document-uploaded"><strong>Uploaded At:</strong> {{ col_item.created_at.strftime("%Y-%m-%d %H:%M:%S") }}</p>
              <div class="a_a-document-actions">
                <a href="/dashboard/collections/{{ col_item.id }}" class="a_a-card-btn">View Details</a>
                <form action="/collections/details/{{ col_item.id }}/{{ document.id }}/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this document from collection?');">
                  <button type="submit" class="a_a-card-btn danger">Delete</button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="a_a-no-documents">No documents in this collection yet.</p>
      {% endif %}
    </div>
  </section>

  <section class="collapsible-section">
    <button class="collapsible-toggle">Add to Collection ▾</button>
    <div class="collapsible-content">
      <div class="a_a-add-documents-form">
        <h3>Select Collections</h3>
        <form action="/documents/details/{{ document.id }}/create" method="post">
          <fieldset>
            {% for collection in all_collections %}
              <div class="checkbox-group">
                <label>
                  <input type="checkbox" name="collections_ids" value="{{ collection.id }}">
                  {{ collection.name }} ({{ collection.created_at.strftime('%Y-%m-%d') }})
                </label>
              </div>
            {% endfor %}
          </fieldset>
          <button type="submit" class="a_a-card-btn">Add to Collection</button>
        </form>
      </div>
    </div>
  </section>

  <section class="collapsible-section">
    <button class="collapsible-toggle">TF-IDF Statistics ▾</button>
    <div class="collapsible-content">
      {% if statistics and statistics.tfidf_json %}
        <table class="tfidf-table">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Term</th>
              <th>TF</th>
              <th>IDF</th>
              <th>Score (TF × IDF)</th>
            </tr>
          </thead>
          <tbody>
            {% for item in statistics.tfidf_json %}
              <tr>
                <td>{{ loop.index }}</td>
                <td>{{ item.term }}</td>
                <td>{{ "%.6f"|format(item.tf) }}</td>
                <td>{{ "%.6f"|format(item.idf) }}</td>
                <td>{{ "%.6f"|format(item.score) }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>

      {% else %}
        <p>No TF-IDF data available for this document.</p>
      {% endif %}
    </div>
  </section>
  <br>
  <br>
  <a href="/dashboard/documents" class="a_a-card-btn">← Back to Documents</a>
</div>


{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', path='scripts/documents-details-script.js') }}"></script>
{% endblock %}
